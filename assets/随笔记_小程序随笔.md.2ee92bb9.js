import{_ as n,o as a,c as p,Q as l}from"./chunks/framework.7518ccd6.js";const o="/zaizaiDocs/assets/image.e57de781.png",e="/zaizaiDocs/assets/xinjianenjian.689b0817.png",r="/zaizaiDocs/assets/kaifazheshezhi.999a41fa.png",s="/zaizaiDocs/assets/fukuai.bf3c6a4a.png",m=JSON.parse('{"title":"小程序随笔","description":"","frontmatter":{},"headers":[],"relativePath":"随笔记/小程序随笔.md","filePath":"随笔记/小程序随笔.md","lastUpdated":1722251927000}'),c={name:"随笔记/小程序随笔.md"},t=l('<h1 id="小程序随笔" tabindex="-1">小程序随笔 <a class="header-anchor" href="#小程序随笔" aria-label="Permalink to &quot;小程序随笔&quot;">​</a></h1><h2 id="原生微信小程序-模块化" tabindex="-1">原生微信小程序 模块化 <a class="header-anchor" href="#原生微信小程序-模块化" aria-label="Permalink to &quot;原生微信小程序 模块化&quot;">​</a></h2><p>截止 2024-2-23，目前微信小程序的模块化默认为 <code>commonJS </code> ,如果你想使用 <code>ES Module</code> 就必需要打开 <code>es6转es5</code> 的编译项目</p><blockquote><p>这样会把所有 es6 的代码全部转换转换为 es5，但是你又不想转换其他的 es6 代码 你就得考虑你的项目需求，如果你不想把项目体积小店就不打开 <code>es6转es5</code> 如果你想使用 <code>ES Module</code> 不考虑其他那就随意</p></blockquote><p><img src="'+o+'" alt="alt text"></p><h2 id="原生微信小程序-环境变量-方案" tabindex="-1">原生微信小程序 <code>环境变量</code> 方案 <a class="header-anchor" href="#原生微信小程序-环境变量-方案" aria-label="Permalink to &quot;原生微信小程序 `环境变量` 方案&quot;">​</a></h2><h3 id="wx-getaccountinfosync-官方提供的-api" tabindex="-1"><code>wx.getAccountInfoSync</code> 官方提供的 API <a class="header-anchor" href="#wx-getaccountinfosync-官方提供的-api" aria-label="Permalink to &quot;`wx.getAccountInfoSync` 官方提供的 API&quot;">​</a></h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/account-info/wx.getAccountInfoSync.html" target="_blank" rel="noreferrer">文档：获取小程序当前版本信息</a></p><div class="danger custom-block"><p class="custom-block-title">缺点：</p><p>在提审时有跟问题，提审的版本会认为是 develop 版导致请求的数据是测试版的，然后被审核拒绝。</p><p>处理办法： develop 环境的接口数据尽量模拟正式环境的接口数据 获取直接放正式环境的接口数据</p></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 自动根据版本切换接口请求地址</span></span>\n<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">miniProgram</span><span style="color:#ABB2BF;">: { </span><span style="color:#E5C07B;">envVersion</span><span style="color:#ABB2BF;"> } } </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">wx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getAccountInfoSync</span><span style="color:#ABB2BF;">();</span></span>\n<span class="line"><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#C678DD;">switch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">envVersion</span><span style="color:#ABB2BF;">) {</span></span>\n<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">case</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;develop&#39;</span><span style="color:#ABB2BF;">:</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">`</span><span style="color:#C678DD;">${</span><span style="color:#E5C07B;">defaultConfig</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">devUrl</span><span style="color:#C678DD;">}${</span><span style="color:#E5C07B;">params</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">url</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">`</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">break</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">case</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;trial&#39;</span><span style="color:#ABB2BF;">:</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">`</span><span style="color:#C678DD;">${</span><span style="color:#E5C07B;">defaultConfig</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">devUrl</span><span style="color:#C678DD;">}${</span><span style="color:#E5C07B;">params</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">url</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">`</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">break</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">case</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;release&#39;</span><span style="color:#ABB2BF;">:</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">`</span><span style="color:#C678DD;">${</span><span style="color:#E5C07B;">defaultConfig</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">prodUrl</span><span style="color:#C678DD;">}${</span><span style="color:#E5C07B;">params</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">url</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">`</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">break</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">default</span><span style="color:#ABB2BF;">:</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">`</span><span style="color:#C678DD;">${</span><span style="color:#E5C07B;">defaultConfig</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">baseUrl</span><span style="color:#C678DD;">}${</span><span style="color:#E5C07B;">params</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">url</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">`</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">break</span><span style="color:#ABB2BF;">;</span></span>\n<span class="line"><span style="color:#ABB2BF;">}</span></span>\n<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">url</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="构建npm功能-方案" tabindex="-1"><code>构建npm功能</code> 方案 <a class="header-anchor" href="#构建npm功能-方案" aria-label="Permalink to &quot;`构建npm功能` 方案&quot;">​</a></h3><p>安装了插件并构建 npm 之后，点上传代码，<code>node_modules</code> 文件夹是不会上传的， <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#packOptions" target="_blank" rel="noreferrer">project.config.json</a>配置项中的 packOptions.ignore 字段， 用以配置打包时对符合指定规则的文件或文件夹进行忽略，以跳过打包的过程，这些文件或文件夹将不会出现在预览或上传的结果内</p><p>首先在根目录新建各种文件 <code>按照自己习惯就好</code></p><p><img src="'+e+`" alt="alt text"></p><p>接着在终端执行 <code>npm init</code>，然后在 <code>package.json</code>中进行配置</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">&quot;type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;module&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">&quot;scripts&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">&quot;build&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;SET NODE_ENV=production &amp;&amp; node ./build/index.js&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">&quot;dev&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;SET NODE_ENV=development &amp;&amp; node ./build/index.js&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后在开发者工具设置</p><p><img src="`+r+`" alt="alt text"></p><p>最后编写 <code>./build/index.js</code></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">fs</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;node:fs&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;node:path&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">fileURLToPath</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;url&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">__dirname</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">dirname</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">fileURLToPath</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">meta</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ph</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;../&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">NODE_ENV</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">process</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">env</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">NODE_ENV</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">files</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">fs</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">readdirSync</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">ph</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">filter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">v</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">v</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.env&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">envFile</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">NODE_ENV</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">===</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;development&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">files</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">] </span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">files</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">str</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">fs</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">readFileSync</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">ph</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">envFile</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">str</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">/\\r\\n/</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">sv</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">svs</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">sv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;=&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">svs</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">trim</span><span style="color:#ABB2BF;">()] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">svs</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">trim</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;&#39;</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">key</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">\`module.exports.</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">key</span><span style="color:#C678DD;">}</span><span style="color:#98C379;"> = </span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">||</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&#39;&#39;&quot;</span><span style="color:#C678DD;">}</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">\`</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#E5C07B;">fs</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">writeFileSync</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;../env.js&#39;</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>搞完，收工 😏</p><h2 id="关于-某些方法需要再点击事件中才能调用" tabindex="-1">关于 <code>某些方法需要再点击事件中才能调用</code> <a class="header-anchor" href="#关于-某些方法需要再点击事件中才能调用" aria-label="Permalink to &quot;关于 \`某些方法需要再点击事件中才能调用\`&quot;">​</a></h2><p>这个大概是根据函数调用的层数来计算的。</p><h2 id="扫码-微信内-h5-支付" tabindex="-1">扫码 微信内 h5 支付 <a class="header-anchor" href="#扫码-微信内-h5-支付" aria-label="Permalink to &quot;扫码 微信内 h5 支付&quot;">​</a></h2><h3 id="方案一" tabindex="-1">方案一 <a class="header-anchor" href="#方案一" aria-label="Permalink to &quot;方案一&quot;">​</a></h3><p>用户使用微信扫一扫=&gt;打开微信 H5=&gt; <img src="`+s+'" alt="alt text"></p><p>=&gt; 输入金额选择微信支付方式(但是没有登录)</p><p>=&gt; 点击付款 （需要登录） 请求后端返回了 ctffront.gdctfsz.com/mp 这个目录的 url 然后你需要 window.location.href = url 然后就跳过去微信的登录网页 （这个过程中就是静默登录了） 然后他会在跳转跳转</p><p>=&gt; 跳转到达 服务器的文件 它会自动调用支付 支付完成在回来</p><p>=》 <img src="'+s+'" alt="alt text"></p><p>=&gt; 回来了 查询支付结果，然后提示支付状态</p><h3 id="方案二" tabindex="-1">方案二 <a class="header-anchor" href="#方案二" aria-label="Permalink to &quot;方案二&quot;">​</a></h3><p>用户使用微信扫一扫=&gt;</p><p>打开微信 H5=&gt;来到这样页面</p><p><img src="'+s+`" alt="alt text"></p><p>=&gt; 输入金额选择微信支付方式 (但是没有登录)</p><p>=&gt; 点击付款 （需要登录）</p><p>首先（静默登录），先跳转去这个页面进行 <code>静默登录</code></p><p><a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx520c15f417810387&amp;redirect_uri=%60%7B%E5%BD%93%E5%89%8D%E9%A1%B5%E9%9D%A2%E7%9A%84URL%7D%60&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect" target="_blank" rel="noreferrer">https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx520c15f417810387&amp;redirect_uri=\`{当前页面的URL}\`&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect</a></p><p><code>静默登录</code> 完成后跳转回来 <code>你的付款页面</code></p><p>拿你需要拿的数据，然后获取<code>订单号</code></p><p>然后调起支付 <code>调用下面的函数</code></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">onBridgeReady</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E5C07B;">WeixinJSBridge</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">invoke</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;getBrandWCPayRequest&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">appId</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;wx2421b1c4370ec43b&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">//公众号ID，由商户传入</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">timeStamp</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;1395712654&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">//时间戳，自1970年以来的秒数</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">nonceStr</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;e61463f8efa94090b1f366cccfbbb444&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">//随机串</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">package</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;prepay_id=u802345jgfjsdfgsdg888&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">signType</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;MD5&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">//微信签名方式：</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">paySign</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;70EA570631E4BB79628FBCA90534C63FF7FADD89&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">//微信签名</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">err_msg</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;get_brand_wcpay_request:ok&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 使用以上方式判断前端返回,微信团队郑重提示：</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  )</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 调用方法</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">typeof</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">WeixinJSBridge</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;undefined&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">addEventListener</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addEventListener</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;WeixinJSBridgeReady&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">onBridgeReady</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">attachEvent</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">attachEvent</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;WeixinJSBridgeReady&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">onBridgeReady</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">attachEvent</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;onWeixinJSBridgeReady&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">onBridgeReady</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">onBridgeReady</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>=&gt; 用户支付完成</p><p>在回调处理支付完成后</p><p><code>注</code>: 一般情况下 提示支付成功 之前先是向后端查询支付成功才提示支付成功，反之失败</p><p>这个回调中不能直接确认支付成功</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">err_msg</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;get_brand_wcpay_request:ok&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 使用以上方式判断前端返回,微信团队郑重提示：</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,48),B=[t];function y(i,F,A,C,d,b){return a(),p("div",null,B)}const E=n(c,[["render",y]]);export{m as __pageData,E as default};
