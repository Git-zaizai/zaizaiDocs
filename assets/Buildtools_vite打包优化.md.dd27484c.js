import{_ as n,o as e,c as l,k as s,a as p,t as o,Q as t}from"./chunks/framework.8218e65d.js";const F=JSON.parse('{"title":"vite打包优化","description":"","frontmatter":{"title":"vite打包优化"},"headers":[],"relativePath":"Buildtools/vite打包优化.md","filePath":"Buildtools/vite打包优化.md","lastUpdated":1722245982000}'),r={name:"Buildtools/vite打包优化.md"},c={id:"frontmatter-title",tabindex:"-1"},i=s("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{$frontmatter.title}}"'},"​",-1),B=t(`<h2 id="打包优化需要优化一些什么东西" tabindex="-1">打包优化需要优化一些什么东西？ <a class="header-anchor" href="#打包优化需要优化一些什么东西" aria-label="Permalink to &quot;打包优化需要优化一些什么东西？&quot;">​</a></h2><ul><li>将零碎的多个文件合并为 1 个文件</li><li>对打包后的结果(如:css/js 文件)进行压缩</li></ul><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>cssCodeSplit</p><p>类型： boolean</p><p>默认： true</p><p>启用/禁用 CSS 代码拆分。当启用时，在异步 chunk 中导入的 CSS 将内联到异步 chunk 本身，并在其被加载时插入。</p></div><p>该配置确实可以把所有得到 css 打包成一个。但是不能把 js 打包在一起啊。所以也不行。</p><h3 id="manualchunks" tabindex="-1">manualChunks <a class="header-anchor" href="#manualchunks" aria-label="Permalink to &quot;manualChunks&quot;">​</a></h3><p>后来又看到 <code>vite</code> 的打包使用的是 <code>rollup</code>，可以通过 <code>build-rollupoptions</code> 配置自定义 <code>rollup</code> 的配置。 <code>rollup</code> 没有 <code>webpack=》splitChunks=》cacheGroups</code> 的属性。但是有 <code>manualChunks</code> 方法。</p><p>::: manualChunks</p><p>Type: { [chunkAlias: string]: string[] } | ((id: string, {getModuleInfo, getModuleIds}) =&gt; string | void)</p><p>Allows the creation of custom shared common chunks. When using the object form, each property represents a chunk that contains the listed modules and all their dependencies if they are part of the module graph unless they are already in another manual chunk. The name of the chunk will be determined by the property key.</p><p>Note that it is not necessary for the listed modules themselves to be part of the module graph, which is useful if you are working with @rollup/plugin-node-resolve and use deep imports from packages. For instance :::</p><p>简而言之可以通过文件 id（路径）自定义设置 key，将相同的 key 打包成一个文件。这不就和 webpack=》cacheGroups=》test 方法类似嘛。于是乎按照我的项目需求将打包分成三个大包。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#98C379;">&quot;build&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;rollupOptions&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">&quot;output&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#98C379;">&quot;entryFileNames&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\`assets/entry/[name][hash].js\`</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#98C379;">&quot;chunkFileNames&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\`assets/chunk/[name][hash].js\`</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#98C379;">&quot;assetFileNames&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\`assets/file/[name][hash].[ext]\`</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">manualChunks</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">id</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;node_modules&quot;</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;vendor&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">//代码分割为第三方包</span></span>
<span class="line"><span style="color:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">id</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;views/modules&quot;</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;views-modules&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">//代码分割为业务视图</span></span>
<span class="line"><span style="color:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">id</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;views/common&quot;</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;views-common&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">//代码分割为common页面登录页</span></span>
<span class="line"><span style="color:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><p><a href="https://cn.vuejs.org/guide/best-practices/performance.html" target="_blank" rel="noreferrer">vue 官方：性能优化</a></p><p><a href="https://router.vuejs.org/zh/guide/advanced/lazy-loading.html" target="_blank" rel="noreferrer">vue-router: 路由懒加载</a></p><p><a href="https://github.com/sanyuan0704/vite-plugin-chunk-split/blob/master/README-CN.md" target="_blank" rel="noreferrer">vite-plugin-chunk-split: Vite 代码拆包插件。支持多种拆包策略，可避免手动操作 manualChunks 潜在的循环依赖问题</a></p><p><a href="https://es6.ruanyifeng.com/#docs/module-loader#%E5%BE%AA%E7%8E%AF%E5%8A%A0%E8%BD%BD" target="_blank" rel="noreferrer">循环加载/循环依赖</a></p><p><a href="https://juejin.cn/post/7135671174893142030" target="_blank" rel="noreferrer">Vite - 代码分割策略</a></p><p><a href="https://juejin.cn/post/7093817000102723620" target="_blank" rel="noreferrer">vite 优化篇-弱网条件下 build 配置的优化</a></p><p><a href="https://juejin.cn/post/7035951233907032077" target="_blank" rel="noreferrer">webpack-bundle-analyzer 优化实战</a></p><p><a href="http://yiming_chang.gitee.io/pure-admin-doc/pages/buildgood/#vite-%E8%87%AA%E8%BA%AB%E7%9A%84%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96" target="_blank" rel="noreferrer">vite-自身的构建优化</a></p>`,22);function u(a,d,y,h,m,b){return e(),l("div",null,[s("h1",c,[p(o(a.$frontmatter.title)+" ",1),i]),B])}const f=n(r,[["render",u]]);export{F as __pageData,f as default};
