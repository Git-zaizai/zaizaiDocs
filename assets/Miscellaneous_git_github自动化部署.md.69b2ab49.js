import{_ as n,o as a,c as l,Q as p}from"./chunks/framework.8218e65d.js";const e="/assets/a587cc83ca2a2e978c308d8b05e13061.f843be3e.png",s="/assets/5d24c1b94823337e97faf4b25bd7dbb3.124b2c84.png",o="/assets/fd3fe87fc8670752a31ec690abd09ef5.99805571.png",t="/assets/b928a016adbc1988b0b9b459f7c1279e.7e6425d1.png",r="/assets/a2c8899e1b7e3a3901e2c5645a962bd8.611c9ada.png",g=JSON.parse('{"title":"GitHub Actions 自动部署","description":"","frontmatter":{},"headers":[],"relativePath":"Miscellaneous/git/github自动化部署.md","filePath":"Miscellaneous/git/github自动化部署.md","lastUpdated":1712056060000}'),c={name:"Miscellaneous/git/github自动化部署.md"},i=p(`<h1 id="github-actions-自动部署" tabindex="-1">GitHub Actions 自动部署 <a class="header-anchor" href="#github-actions-自动部署" aria-label="Permalink to &quot;GitHub Actions 自动部署&quot;">​</a></h1><p><a href="https://github.com/features/actions" target="_blank" rel="noreferrer">GitHub Actions</a> 是 GitHub 的持续集成服务 <strong>参考：</strong> <a href="https://zhuanlan.zhihu.com/p/626270948" target="_blank" rel="noreferrer">资料地址</a></p><p>首先在项目的根目录创建文件</p><div class="tip custom-block"><p class="custom-block-title">目录-文件</p><ul><li>.github 目录 <ul><li>-workflows 目录 - -xxx.yml 文件 -- 文件名随意 支持 .yml .yaml 两种格式</li></ul></li></ul></div><h3 id="编写-workflow-文件" tabindex="-1">编写 <code>workflow</code> 文件 <a class="header-anchor" href="#编写-workflow-文件" aria-label="Permalink to &quot;编写 \`workflow\` 文件&quot;">​</a></h3><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#98C379;">ACCESS_TOKEN# 流程名称 随意起</span></span>
<span class="line"><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Actions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 触发条件</span></span>
<span class="line"><span style="color:#D19A66;">on</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 手动触发</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">workflow_dispatch</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># push 到指定分支</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">push</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">branches</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">main</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 只在下列路径变更时触发</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">paths</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">&#39;docs/**&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">&#39;package.json&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置上海时区</span></span>
<span class="line"><span style="color:#E06C75;">env</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">TZ</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Asia/Shanghai</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 任务</span></span>
<span class="line"><span style="color:#E06C75;">jobs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">build-and-deploy</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 服务器环境：最新版 ubuntu</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">runs-on</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">ubuntu-latest</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">steps</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 拉取代码</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Checkout</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/checkout@v2</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">persist-credentials</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 安装 pnpm</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Install pnpm</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 设置 node 版本</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Set node version to 18</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/setup-node@v2</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">node-version</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">18</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">cache</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;pnpm&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 打包静态文件</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Build</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">pnpm install &amp;&amp; pnpm run docs:build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 部署</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Deploy</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">JamesIves/github-pages-deploy-action@v4.4.0</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#7F848E;font-style:italic;"># GitHub 密钥</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">ACCESS_TOKEN</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ secrets.ACCESS_TOKEN }}</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#7F848E;font-style:italic;"># GitHub Pages 读取的分支</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">BRANCH</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">gh-pages</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#7F848E;font-style:italic;"># 静态文件所在目录</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">FOLDER</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dist</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p><strong>请根据实例实际修改相应的配置</strong>，大概这些配置相信你大概能看得懂的，更多配置想请自行查阅</p><h3 id="配置文件变量的使用" tabindex="-1">配置文件变量的使用 <a class="header-anchor" href="#配置文件变量的使用" aria-label="Permalink to &quot;配置文件变量的使用&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在查资料的过程中发现有些是不配置这个的，如没有使用请略过这一片段</p></div><p>在 <code>workflow</code> 文件中有</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#98C379;">\${{ secrets.**** }}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这种就是使用到了变量，所有你需要去配置一下</p><h4 id="配置-secrets-也叫-变量吧" tabindex="-1">配置 Secrets 也叫 变量吧 <a class="header-anchor" href="#配置-secrets-也叫-变量吧" aria-label="Permalink to &quot;配置 Secrets 也叫 变量吧&quot;">​</a></h4><p>以这个 <code>ACCESS_TOKEN</code> 来配置，首先，要去 github 生成需要的 token。<a href="https://github.com/settings/tokens?type=beta" target="_blank" rel="noreferrer">前往：生成 token</a></p><blockquote><p><em>----------------------------------------------------------------------------------------------------</em></p></blockquote><p>登录后操作 <img src="`+e+'" alt="png"></p><blockquote><p><em>----------------------------------------------------------------------------------------------------</em></p></blockquote><p>填写完图上指示</p><blockquote><p><strong>注意事项： 生成好的 token 只能看见一次，请保存好 token，忘了只能删除后重新生成</strong></p></blockquote><p><img src="'+s+'" alt="png"></p><blockquote><p><em>----------------------------------------------------------------------------------------------------</em></p></blockquote><p>接着去到 github 项目设置</p><p><img src="'+o+'" alt="截图"></p><blockquote><p><em>----------------------------------------------------------------------------------------------------</em></p></blockquote><p>注意 **Name **字段不能随便写，根据你使用变量名填写；<strong>value</strong> 要看你使用的地方来，例如本文件中的 <strong>ACCESS_TOKEN</strong> 字段 就是需要你去生成 token，当其他自行需要时可以自定义 value</p><p><img src="'+s+'" alt="截图"></p><h2 id="actions-permissions" tabindex="-1">Actions permissions <a class="header-anchor" href="#actions-permissions" aria-label="Permalink to &quot;Actions permissions&quot;">​</a></h2><p>接着需要开启仓库 <strong>Actions</strong> 读写权限</p><p><img src="'+t+'" alt="截图"></p><blockquote><p><em>----------------------------------------------------------------------------------------------------</em></p></blockquote><p>拉到页面最下面，选择 <strong>Read and write permissions</strong> ，就完成了</p><p><img src="'+r+`" alt="截图"></p><h2 id="正常提交代码" tabindex="-1">正常提交代码... <a class="header-anchor" href="#正常提交代码" aria-label="Permalink to &quot;正常提交代码...&quot;">​</a></h2><p>额，这就不说了 git 提交都会的</p><h2 id="查看部署情况" tabindex="-1">查看部署情况 <a class="header-anchor" href="#查看部署情况" aria-label="Permalink to &quot;查看部署情况&quot;">​</a></h2><p><img src="https://gitcode.net/ajream/myimages/-/raw/master/img/20210913232007_image-20210913232006065.png" alt="png"></p><p>点击正在运行的 workflow 就可以查看部署情况</p><p><img src="https://gitcode.net/ajream/myimages/-/raw/master/img/20210913233832_image-20210913233828678.png" alt="png"></p><p><img src="https://gitcode.net/ajream/myimages/-/raw/master/img/20210913234019_image-20210913234018254.png" alt="png"></p><h1 id="结束" tabindex="-1">结束 <a class="header-anchor" href="#结束" aria-label="Permalink to &quot;结束&quot;">​</a></h1><pre><code>到此，流程结束，不出意外你就可以去打开github pages，然后就可以访问到部署的网站。
</code></pre>`,41),B=[i];function b(y,u,m,d,A,F){return a(),l("div",null,B)}const C=n(c,[["render",b]]);export{g as __pageData,C as default};
